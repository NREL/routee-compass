
<!DOCTYPE html>


<html lang="python" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>App Config &#8212; RouteE Compass</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=30a733bc"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'config';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API Docs" href="python_api_docs.html" />
    <link rel="prev" title="Query" href="query.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="python"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/routeelogo.png" class="logo__image only-light" alt="RouteE Compass - Home"/>
    <script>document.write(`<img src="_static/routeelogo.png" class="logo__image only-dark" alt="RouteE Compass - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    RouteE Compass
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="examples/01_open_street_maps_example.html">OpenStreetMap Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/02_different_powertrains_example.html">Different Powertrains Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/03_time_energy_tradeoff_example.html">Time Energy Tradeoff Example</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="query.html">Query</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">App Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api_docs.html">Python API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="rust_api_docs.html">Rust API Docs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="developers/build_the_docs.html">Build The Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers/rust_code_style.html">Rust Code Style</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NREL/routee-compass" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NREL/routee-compass/issues/new?title=Issue%20on%20page%20%2Fconfig.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/config.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>App Config</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping-model">Mapping Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#traversal-models">Traversal Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance">Distance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#speed">Speed</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time">Time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grade">Grade</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elevation">Elevation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#energy">Energy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plugins">Plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-plugins">Input Plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grid-search">Grid Search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-balancer">Load Balancer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-plugins">Output Plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traversal">Traversal</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="app-config">
<h1>App Config<a class="headerlink" href="#app-config" title="Link to this heading">#</a></h1>
<p>Each <code class="docutils literal notranslate"><span class="pre">CompassApp</span></code> instance is defined by a configuration toml file.
The configuration file specifies things like &quot;Which traversal model should I use, and what are its parameters?&quot; and &quot;Which data sources should I use?&quot;.</p>
<p>If you follow the <a class="reference internal" href="examples/01_open_street_maps_example.html"><span class="doc std std-doc">open street maps example</span></a>, the code will produce a few configuration files in the <code class="docutils literal notranslate"><span class="pre">golden_co/</span></code> folder. Let's take a look at the <code class="docutils literal notranslate"><span class="pre">osm_default_energy.toml</span></code> file.
We added some annotations to describe the different sections:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># how many threads should a CompassApp use to process queries?</span>
<span class="n">parallelism</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="c1"># the parameters for the underlying road network graph</span>
<span class="k">[graph]</span>
<span class="c1"># a file containing all the graph edges and their adjacencies</span>
<span class="n">edge_list_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-compass.csv.gz&quot;</span>
<span class="c1"># a file containing all the graph verticies</span>
<span class="n">vertex_list_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vertices-compass.csv.gz&quot;</span>
<span class="c1"># if verbose is true, you&#39;ll see more information when loading the graph</span>
<span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="k">[mapping]</span>
<span class="c1"># vertex or edge-oriented mapping</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edge&quot;</span>
<span class="c1"># geometries used to build linestrings</span>
<span class="n">geometry_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-geometries-enumerated.txt.gz&quot;</span>
<span class="c1"># mapping threshold</span>
<span class="n">tolerance</span><span class="p">.</span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">15.0</span>
<span class="c1"># mapping threshold distance unit</span>
<span class="n">tolerance</span><span class="p">.</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meters&quot;</span>
<span class="c1"># allow queries without destinations, for shortest path tree results</span>
<span class="n">queries_without_destinations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="c1"># whether we match queries via &quot;point&quot;, &quot;vertex_id&quot;, or &quot;edge_id&quot; (or arrays of combinations)</span>
<span class="n">matching_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;point&quot;</span>

<span class="k">[traversal]</span>
<span class="c1"># the traversal section can either be a single model configuration, or, if &quot;combined&quot;</span>
<span class="c1"># is specified, it can be a collection of models listed at [[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;combined&quot;</span>
<span class="k">[[traversal.models]]</span>
<span class="c1"># model distances in miles</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;distance&quot;</span>
<span class="n">distance_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;miles&quot;</span>

<span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;speed&quot;</span>
<span class="c1"># the file that has speeds for each edge in the graph</span>
<span class="n">speed_table_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-posted-speed-enumerated.txt.gz&quot;</span>
<span class="c1"># the units of the values in the speed table</span>
<span class="n">speed_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;kph&quot;</span>

<span class="k">[[traversal.models]]</span>
<span class="c1"># model time in minutes using the above distances and speeds</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;time&quot;</span>
<span class="n">time_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;minutes&quot;</span>

<span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grade&quot;</span>
<span class="c1"># the file that has grades for each edge in the graph</span>
<span class="n">grade_table_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-grade-enumerated.txt.gz&quot;</span>
<span class="c1"># the units of the grade table</span>
<span class="n">grade_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;decimal&quot;</span>

<span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;energy&quot;</span>

<span class="c1"># here, we specify which vehicles to make available at query time</span>
<span class="c1"># if you wanted to add more models, you would make a new [[traversal.models.vehicles]] section.</span>
<span class="k">[[traversal.models.vehicles]]</span>
<span class="c1"># the name of the model that can be passed in from a query as &quot;model_name&quot;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012_Ford_Focus&quot;</span>
<span class="c1"># the type of the vehicle, currently either:</span>
<span class="c1"># - &quot;ice&quot; i.e. Internal Combustion Engine (ICE)</span>
<span class="c1"># - &quot;bev&quot; i.e. Battery Electric Vehicle (BEV)</span>
<span class="c1"># - &quot;phev&quot; i.e. Plug-in Hybrid Electric Vehicle (PHEV)</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ice&quot;</span>
<span class="c1"># the file for the routee-powertrain model</span>
<span class="n">model_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/2012_Ford_Focus.bin&quot;</span>
<span class="c1"># the units of what the routee-powertrain model expects speed to be in</span>
<span class="n">speed_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mph&quot;</span>
<span class="c1"># the units of what the routee-powertrain model expects grade to be in</span>
<span class="n">grade_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;decimal&quot;</span>
<span class="c1"># the units of what the routee-powertrain model outputs for energy</span>
<span class="n">energy_rate_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gallons gasoline/mile&quot;</span>
<span class="c1"># the &quot;best case&quot; energy rate for this particular vehicle (something like highway mpg) that&#39;s used in the a-star algorithm</span>
<span class="n">ideal_energy_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.02857143</span>
<span class="c1"># A real world adjustment factor for things like temperature and auxillary loads</span>
<span class="n">real_world_energy_adjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.166</span>

<span class="c1"># what underlying machine learn framework to use [smartcore | interpolate ]</span>
<span class="c1"># in this case we use a model that interpolates the underlying model type over a regular grid</span>
<span class="k">[traversal.models.vehicles.model_type.interpolate]</span>
<span class="n">underlying_model_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;smartcore&quot;</span>
<span class="n">speed_lower_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">speed_upper_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">speed_bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">101</span>
<span class="n">grade_lower_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.2</span>
<span class="n">grade_upper_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span>
<span class="n">grade_bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">41</span>

<span class="c1">## The cost section defines how we translate the search state into a cost that is minimized by the algorithm</span>

<span class="c1"># The vehicle rates get applied to each component of the cost</span>

<span class="c1"># based on 65.5 cents per mile 2023 IRS mileage rate, $/mile</span>
<span class="k">[cost.vehicle_rates.trip_distance]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;factor&quot;</span>
<span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.655</span>

<span class="c1"># based on $20/hr approximation of 2023 median hourly wages, $/second</span>
<span class="k">[cost.vehicle_rates.trip_time]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;factor&quot;</span>
<span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.333336</span>

<span class="c1"># based on AAA regular unleaded gas prices sampled 12/21/2023</span>
<span class="k">[cost.vehicle_rates.trip_energy_liquid]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;factor&quot;</span>
<span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.120</span>

<span class="c1"># based on $0.50/kWh approximation of DCFC charge rates, $/kWhtype = &quot;factor&quot;</span>
<span class="k">[cost.vehicle_rates.trip_energy_electric]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;factor&quot;</span>
<span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.50</span>

<span class="c1"># Each cost component get multiplied by the corresponding vehicle weight.</span>
<span class="c1"># So, you could make time more important than distance by increasing the time weight.</span>
<span class="k">[cost.weights]</span>
<span class="n">trip_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">trip_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">trip_energy_liquid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">trip_energy_electric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="c1">## Access costs</span>

<span class="c1"># A turn delay model that assigns a time cost to each type of turn</span>
<span class="k">[access]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;turn_delay&quot;</span>
<span class="n">edge_heading_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-headings-enumerated.csv.gz&quot;</span>
<span class="k">[access.turn_delay_model]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tabular_discrete&quot;</span>
<span class="n">time_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;seconds&quot;</span>
<span class="k">[access.turn_delay_model.table]</span>
<span class="n">no_turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="n">slight_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
<span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">sharp_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span>
<span class="n">slight_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5</span>
<span class="n">sharp_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.5</span>
<span class="n">u_turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.5</span>

<span class="c1"># which plugins should be activated?</span>
<span class="k">[plugin]</span>
<span class="n">input_plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="c1"># The grid search allows you to specify a &quot;grid_search&quot; key in the query and it will generate multiple queries from those parameters.</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;grid_search&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1"># The load balancer estimates the runtime for each query and is used by CompassApp to best leverage parallelism.</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;load_balancer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">weight_heuristic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;haversine&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="p">]</span>
<span class="n">output_plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="c1"># The traversal plugin appends various items to the result.</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;traversal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;geo_json&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1"># The uuid plugin adds a map specific id (like Open Street Maps Nodes) onto the compass verticies</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">uuid_input_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;vertices-uuid-enumerated.txt.gz&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<section id="mapping-model">
<h2>Mapping Model<a class="headerlink" href="#mapping-model" title="Link to this heading">#</a></h2>
<p>The mapping model deals with geospatial mappings from the road network graph. This may be represented using the graph vertices and drawing lines between coordinates, or, by loading LineString geometries from a file.</p>
<p>For example, if you specify your query origin and destination as lat/lon coordinates (i.e. <code class="docutils literal notranslate"><span class="pre">origin_x</span></code>, <code class="docutils literal notranslate"><span class="pre">origin_y</span></code>) we need a way to match this to the graph and then insert an <code class="docutils literal notranslate"><span class="pre">origin_vertex</span></code> or a <code class="docutils literal notranslate"><span class="pre">destination_vertex</span></code> into the query. Those two fields are what the application expects when conducting a search.</p>
<p>For vertex-oriented mapping, all fields are optional.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[mapping]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vertex&quot;</span>

<span class="c1"># # when type = &quot;vertex&quot;, this can be omitted, and the system will</span>
<span class="c1"># # instead use the graph vertex coordinates to build map geometries</span>
<span class="c1"># # which produces far simpler route sequences as a result.</span>
<span class="c1"># geometry_input_file = &quot;edges-geometries-enumerated.txt.gz&quot;</span>

<span class="c1"># # optional query distance tolerance for map matching.</span>
<span class="c1"># tolerance.distance = 15.0</span>
<span class="c1"># tolerance.unit = &quot;meters&quot;</span>

<span class="c1"># # allow user to submit queries without destinations, such as when</span>
<span class="c1"># # shortest path trees are the desired result, not routes. true by default.</span>
<span class="c1"># queries_without_destinations = true</span>

<span class="c1"># # the default map input type is a combined strategy that attempts to</span>
<span class="c1"># # match by Point, otherwise expects the user to pass either a vertex ({origin|destination}_vertex)</span>
<span class="c1"># # or an edge ({origin|destination}_edge). a more restrictive strategy can be</span>
<span class="c1"># # specified here with a subset of these values or a single value such as &quot;point&quot;.</span>
<span class="c1"># matching_type = [&quot;point&quot;, &quot;edge_id&quot;, &quot;vertex_id&quot;]</span>
</pre></div>
</div>
<p>Edge-oriented mapping uses some additional (non-optional) line geometry input and builds a spatial lookup over those lines.</p>
<p>This model will map coordinates to <code class="docutils literal notranslate"><span class="pre">origin_edge</span></code> or a <code class="docutils literal notranslate"><span class="pre">destination_edge</span></code> into the query.</p>
<p>As opposed to vertex-oriented mapping, the edge-oriented will additionally apply any frontier model rules to any mapped edges, preventing mapping assignments that are invalid frontiers.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[mapping]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edge&quot;</span>
<span class="n">geometry_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-geometries-enumerated.txt.gz&quot;</span>

<span class="c1"># # optional query distance tolerance for map matching.</span>
<span class="c1"># tolerance.distance = 15.0</span>
<span class="c1"># tolerance.unit = &quot;meters&quot;</span>

<span class="c1"># # allow user to submit queries without destinations, such as when</span>
<span class="c1"># # shortest path trees are the desired result, not routes. true by default.</span>
<span class="c1"># queries_without_destinations = true</span>

<span class="c1"># # the default map input type is a combined strategy that attempts to</span>
<span class="c1"># # match by Point, otherwise expects the user to pass either a vertex ({origin|destination}_vertex)</span>
<span class="c1"># # or an edge ({origin|destination}_edge). a more restrictive strategy can be</span>
<span class="c1"># # specified here with a subset of these values or a single value such as &quot;point&quot;.</span>
<span class="c1"># matching_type = [&quot;point&quot;, &quot;edge_id&quot;, &quot;vertex_id&quot;]</span>
</pre></div>
</div>
</section>
<section id="traversal-models">
<h2>Traversal Models<a class="headerlink" href="#traversal-models" title="Link to this heading">#</a></h2>
<p>Traversal models are what the application uses when computing a path through the graph.
The models can use things like road speed to compute the shortest time route or vehicle energy consumption to compute a route that uses the least energy.
Here are the default traversal models that come with the <code class="docutils literal notranslate"><span class="pre">CompassApp</span></code>:</p>
<section id="distance">
<h3>Distance<a class="headerlink" href="#distance" title="Link to this heading">#</a></h3>
<p>The distance traversal model is a very simple model that just uses distance for computing a route, producing the route that has the shortest distance.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;distance&quot;</span>
<span class="n">distance_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;miles&quot;</span>
</pre></div>
</div>
</section>
<section id="speed">
<h3>Speed<a class="headerlink" href="#speed" title="Link to this heading">#</a></h3>
<p>The speed table traversal model uses a speed lookup table to assign edge speeds.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;speed&quot;</span>
<span class="n">speed_table_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-posted-speed-enumerated.txt.gz&quot;</span>
<span class="n">speed_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;kph&quot;</span>
</pre></div>
</div>
</section>
<section id="time">
<h3>Time<a class="headerlink" href="#time" title="Link to this heading">#</a></h3>
<p>This simple model computes traversal time based on upstream distance and speed models.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;time&quot;</span>
<span class="n">time_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;minutes&quot;</span>
</pre></div>
</div>
</section>
<section id="grade">
<h3>Grade<a class="headerlink" href="#grade" title="Link to this heading">#</a></h3>
<p>Uses a lookup table to assign grade values.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grade&quot;</span>
<span class="n">grade_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;edges-grade-enumerated.txt.gz&quot;</span>
<span class="n">grade_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;decimal&quot;</span>
</pre></div>
</div>
</section>
<section id="elevation">
<h3>Elevation<a class="headerlink" href="#elevation" title="Link to this heading">#</a></h3>
<p>Assigns elevation gain and loss calculated from the grade value and distance.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;elevation&quot;</span>
<span class="n">distance_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;feet&quot;</span>
</pre></div>
</div>
</section>
<section id="energy">
<h3>Energy<a class="headerlink" href="#energy" title="Link to this heading">#</a></h3>
<p>The energy model computes energy (with a routee-powertrain vehicle model) and speed over an edge.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[traversal.models]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;energy&quot;</span>

<span class="c1"># here, we specify which vehicles to make available at query time</span>
<span class="c1"># if you wanted to add more models, you would make a new [[traversal.models.vehicles]] section.</span>
<span class="k">[[traversal.models.vehicles]]</span>
<span class="c1"># the name of the model that can be passed in from a query as &quot;model_name&quot;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012_Ford_Focus&quot;</span>
<span class="c1"># the type of the vehicle, currently either:</span>
<span class="c1"># - &quot;ice&quot; i.e. Internal Combustion Engine (ICE)</span>
<span class="c1"># - &quot;bev&quot; i.e. Battery Electric Vehicle (BEV)</span>
<span class="c1"># - &quot;phev&quot; i.e. Plug-in Hybrid Electric Vehicle (PHEV)</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ice&quot;</span>
<span class="c1"># the file for the routee-powertrain model</span>
<span class="n">model_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/2012_Ford_Focus.bin&quot;</span>
<span class="c1"># the units of what the routee-powertrain model expects speed to be in</span>
<span class="n">speed_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mph&quot;</span>
<span class="c1"># the units of what the routee-powertrain model expects grade to be in</span>
<span class="n">grade_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;decimal&quot;</span>
<span class="c1"># the units of what the routee-powertrain model outputs for energy</span>
<span class="n">energy_rate_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gallons gasoline/mile&quot;</span>
<span class="c1"># the &quot;best case&quot; energy rate for this particular vehicle (something like highway mpg) that&#39;s used in the a-star algorithm</span>
<span class="n">ideal_energy_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.02857143</span>
<span class="c1"># A real world adjustment factor for things like temperature and auxillary loads</span>
<span class="n">real_world_energy_adjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.166</span>

<span class="c1"># what underlying machine learn framework to use [smartcore | interpolate ]</span>
<span class="c1"># in this case we use a model that interpolates the underlying model type over a regular grid</span>
<span class="k">[traversal.models.vehicles.model_type.interpolate]</span>
<span class="n">underlying_model_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;smartcore&quot;</span>
<span class="n">speed_lower_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">speed_upper_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">speed_bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">101</span>
<span class="n">grade_lower_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.2</span>
<span class="n">grade_upper_bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span>
<span class="n">grade_bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">41</span>
</pre></div>
</div>
</section>
</section>
<section id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="Link to this heading">#</a></h2>
<p>Input and output plugins are used to modify the queries and the results respectively.
Both queries and results are valid json objects and so a plugin takes in a json object and returns a json object.</p>
</section>
<section id="input-plugins">
<h2>Input Plugins<a class="headerlink" href="#input-plugins" title="Link to this heading">#</a></h2>
<p>Here are the default input plugins that are provided:</p>
<section id="grid-search">
<h3>Grid Search<a class="headerlink" href="#grid-search" title="Link to this heading">#</a></h3>
<p>The grid search plugin allows you to specify a <code class="docutils literal notranslate"><span class="pre">grid_search</span></code> key in the query and it will generate multiple queries from those parameters. For example, if you had a query:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;origin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Government Center Station&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;destination_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cannonball Creek Brewery&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;origin_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.200146</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;origin_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.72657</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;destination_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.234964</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;destination_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.768477</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016_TOYOTA_Camry_4cyl_2WD&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;grid_search&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;test_cases&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shortest_time&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;trip_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;trip_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;trip_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;least_energy&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;trip_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;trip_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;trip_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The grid search plugin would take this single query and generate two queries that would be fed into the application:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;origin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Government Center Station&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cannonball Creek Brewery&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;origin_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.200146</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;origin_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.72657</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.234964</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.768477</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016_TOYOTA_Camry_4cyl_2WD&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shortest_time&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;trip_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trip_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trip_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;origin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Government Center Station&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cannonball Creek Brewery&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;origin_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.200146</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;origin_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.72657</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-105.234964</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;destination_y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">39.768477</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;least_energy&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016_TOYOTA_Camry_4cyl_2WD&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;trip_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trip_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trip_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[plugin.input_plugins]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grid_search&quot;</span>
</pre></div>
</div>
</section>
<section id="load-balancer">
<h3>Load Balancer<a class="headerlink" href="#load-balancer" title="Link to this heading">#</a></h3>
<p>The load balancer plugin estimates the runtime for each query. That information is used by <code class="docutils literal notranslate"><span class="pre">CompassApp</span></code> in order to best leverage parallelism.</p>
<p>For example, we have configured a parallelism of 2 and have 4 queries, but one query is a cross-country trip and will take a very long time to run.
With the load balancer plugin, Compass will identify this and bundle the three smaller queries together:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">naive</span> <span class="o">=</span> <span class="p">[[</span><span class="n">long</span><span class="p">,</span> <span class="n">short</span><span class="p">],</span> <span class="p">[</span><span class="n">short</span><span class="p">,</span> <span class="n">short</span><span class="p">]]</span>
<span class="n">balanced</span> <span class="o">=</span> <span class="p">[[</span><span class="n">long</span><span class="p">],</span> <span class="p">[</span><span class="n">short</span><span class="p">,</span> <span class="n">short</span><span class="p">,</span> <span class="n">short</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[plugin.input_plugins]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;load_balancer&quot;</span>
<span class="c1"># method for estimating query runtime, in this case haversine distance in kilometers.</span>
<span class="c1"># this heuristic only works for trips with origin/destination pairs.</span>
<span class="n">weight_heuristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;haversine&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>if a user has fields on their queries that can be used directly or mapped to weight values, they may use
the custom weight heuristic. this numeric example expects a field <code class="docutils literal notranslate"><span class="pre">my_weight_value:</span> <span class="pre">float</span></code> on each query:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[plugin.input_plugins]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;load_balancer&quot;</span>
<span class="k">[plugin.input_plugins.weight_heuristic]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<span class="k">[plugin.input_plugins.weight_heuristic.custom_weight_type]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;numeric&quot;</span>
<span class="n">column_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_weight_value&quot;</span>
</pre></div>
</div>
<p>categorical fields are also supported by providing a mapping. this example expects a <code class="docutils literal notranslate"><span class="pre">mode</span></code> field
and uses values <code class="docutils literal notranslate"><span class="pre">[walk,</span> <span class="pre">bike,</span> <span class="pre">drive]</span></code> to map to weight values of 1, 10, and 100, for example
based on observed search sizes for each travel mode.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[plugin.input_plugins]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;load_balancer&quot;</span>
<span class="k">[plugin.input_plugins.weight_heuristic]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<span class="k">[plugin.input_plugins.weight_heuristic.custom_weight_type]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;categorical&quot;</span>
<span class="n">column_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mode&quot;</span>
<span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;walk&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bike&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;drive&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="output-plugins">
<h2>Output Plugins<a class="headerlink" href="#output-plugins" title="Link to this heading">#</a></h2>
<p>Here are the default output plugins that are provided:</p>
<section id="traversal">
<h3>Traversal<a class="headerlink" href="#traversal" title="Link to this heading">#</a></h3>
<p>A plugin that appends various items to the result. It leverages the mapping model for route and tree geometry generation.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[plugin.output_plugins]]</span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;traversal&quot;</span>
<span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;geo_json&quot;</span>
<span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;geo_json&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">route</span></code> key will add route information to the result depending on the type.
The <code class="docutils literal notranslate"><span class="pre">tree</span></code> key will add search tree information to the result depending on the type (be aware that this could be very large for searches that span a large geographical distance).</p>
<p>Both the <code class="docutils literal notranslate"><span class="pre">route</span></code> and the <code class="docutils literal notranslate"><span class="pre">tree</span></code> key are optional and if omitted, the plugin will not append anything for it. In addition both keys can be specified in the following formats:</p>
<ul class="simple">
<li><p>&quot;json&quot;: non-geometry output writing traversal metrics (cost, state) as JSON for a route or a tree</p></li>
<li><p>&quot;wkt&quot;: outputs a LINESTRING for a route, or a MULTILINESTRING for a tree</p></li>
<li><p>&quot;geo_json&quot;: annotated geometry data as a FeatureCollection of LineStrings with properties assigned from traversal metrics</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="query.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Query</p>
      </div>
    </a>
    <a class="right-next"
       href="python_api_docs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Python API Docs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping-model">Mapping Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#traversal-models">Traversal Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance">Distance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#speed">Speed</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time">Time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grade">Grade</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elevation">Elevation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#energy">Energy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plugins">Plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-plugins">Input Plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grid-search">Grid Search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-balancer">Load Balancer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-plugins">Output Plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traversal">Traversal</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By National Renewable Energy Laboratory
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>